enum ActionKind {
    RunningLeft,
    RunningRight,
    Idle,
    IdleLeft,
    IdleRight,
    JumpingLeft,
    JumpingRight,
    CrouchLeft,
    CrouchRight,
    Flying,
    Walking,
    Jumping
}
namespace SpriteKind {
    export const Bumper = SpriteKind.create()
    export const Goal = SpriteKind.create()
    export const Coin = SpriteKind.create()
    export const Flier = SpriteKind.create()
}
controller.A.onEvent(ControllerButtonEvent.Pressed, function () {
    attemptJump()
})
controller.up.onEvent(ControllerButtonEvent.Pressed, function () {
    attemptJump()
})
controller.down.onEvent(ControllerButtonEvent.Pressed, function () {
    if (!(hero.isHittingTile(CollisionDirection.Bottom))) {
        null.x += 0
    }
})
let canDoubleJump = false
let heroFacingLeft = false
let hero: Sprite = null
hero = sprites.create(img`
    . . . . . . . . . . . . . . . . 
    . . . . . . 5 5 5 5 . . . . . . 
    . . . . 5 5 5 5 5 5 5 5 . . . . 
    . . . 5 5 5 5 5 5 5 5 5 5 . . . 
    . . 5 5 5 9 9 5 5 5 9 9 5 5 . . 
    . . 5 5 5 9 9 5 5 5 9 9 5 5 . . 
    . 5 5 5 5 5 5 5 5 5 5 5 5 5 5 . 
    . 5 5 5 5 5 5 5 5 5 5 5 5 5 5 . 
    . 5 5 5 5 5 5 5 5 5 5 5 5 5 5 . 
    . 5 5 5 5 5 5 5 5 5 5 5 5 5 5 . 
    . . 5 5 2 2 2 2 2 2 5 5 5 5 . . 
    . . 5 5 5 5 5 5 5 5 5 5 5 5 . . 
    . . . 5 5 5 5 5 5 5 5 5 5 . . . 
    . . . . 5 5 5 5 5 5 5 5 . . . . 
    . . . . . . 5 5 5 5 . . . . . . 
    . . . . . . . . . . . . . . . . 
    `, SpriteKind.Player)
// how long to pause between each contact with a
// single enemy
let invincibilityPeriod = 600
let pixelsToMeters = 30
let gravity = 9.81 * pixelsToMeters
scene.setBackgroundImage(img`
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444499444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444955994444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444449555559444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444495555555944444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444955555555594444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444955555555559444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444449555555555555944444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444495555555555555944444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444955555555555555944444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444494444444444444444444449555555555555555944444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444449444444444444444444449555555555555555594444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444449444444444444444444495555555555555555594444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444449444444444444444444495555555555555555594444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444449444444444444444444955555555555555555559444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444449444444444444444444955555555555555555559444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444449444444444444444449555555555555555555559444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444449444444444444444449555555555555555555559444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444449444444444444444495555555555555555555559444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444449444444444444444495555555555555555555559444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444449444444444444444955555555555555555555559444444444444444444444444444444444444499444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444944444444444444955555555555555555555559444444444444444444444444444444444449944444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444944444444444449555555555555555555555559444444444444444444444444444444449994444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444944444444444449555555555555555555555594444444444444444444444444444499999444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444944444444444495555555555555555555555594444444444444444444444444499955994444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444944444444444495555555555555555555555594444444444444444444444999955559444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444944444444444495555555555555555555555594444444444444444444999555555994444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444944444444444955555555555555555555555594444444444444444999555555559444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444944444444444955555555555555555555555594444444444449999555555555994444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444944444444449555555555555555555555555944444444449995555555555599444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444944444444449555555555555555555555555944444449995555555555555944444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444494444444495555555555555555555555555944444995555555555555599444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444494444444495555555555555555555555555944999555555555555555944444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444494444444495555555555555555555555555999555555555555555599444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444449444444955555555555555555555555999555555555555555555944444444444444444444444444444444444444444444444444499994444444444444444444444444
    4444444444444444444444444449444444955555555555555555555599889555555555555555599444444444444444444444444444444444444444444444449999994444444444444444444444444444
    4444444444444444444444444449444449555555555555555555599988889555555555555555944444444444444444444444444444444444444444499999995999444444444444444444444444444444
    4444444444444444444444444444944449555555555555555999988888889555555555555599444444444444444444444444444444444499999999955555599444444444444444444444444444444444
    4444444444444444444444444444944495555555555559999888888888895555555555559944444444444444444444444444499999999955555555555599944444444444444444444444444444444444
    4444444444444444444444444444944495555555599998888888888888895555555555594444444999999999999999999999955555555555555555599944444444444444444444444444444444444444
    4444444444444444444444444444494495559999988888888888888888895555555999999999999888899999999955555555555555555555555599944444444444444444444444444444444444444444
    4444444444444444444444444444494999998888888888889999999999999999999559999999999999955555555555555555555555555555599999999994444444444444444444444444444444444444
    4444444444444444444444444449999999999999999999999999999999955555555555555555555555555555555555555555555555555559999999999999444444444444444444444444444444444444
    4444444444444444444444444444449999999999999999999999999999955555555555555555555555555555555555555555555555559999999999999994444444444444444444444444444444444444
    4444444444444444444444444444449999999999999999999999999999955555555555555555555555555555555555555555555559999999999999999944444444444444444444444444444444444444
    4444444444444444444444444444449999999999999999999999999999955555555555555555555555555555555555555555599999999999999999999444444444444444444444444444444444444444
    4444444444444444444444444444449999999999999999999999999999555555555555555555555555555555555555555999999999999999999999994444444444444444444444444444444444444444
    4444444444444444444444444444449999999999999999999999999999555555555555555555555555555555555559999999999999999999999999944444444444444444444444444444444444444444
    4444444444444444444444444444449999999999999999999999999999555555555555555555555555555555599998899999999999999999999999444444444444444444444444444444444444444444
    4444444444444444444444444444449899999999999999999999999995555555555555555555555555599999988899999999999999999999999994444444444444444444444444444444444444444444
    4444444444444444444444444444449899999999999999999999999995555555555555555555599999988888889999999999999999999999999444444444444444444444444444444444444444444444
    4444444444444444444444444444449899999999999999999999999995555555555555999999988888888889999999999999999999999999944444444444444444444444444444444444444444444444
    4444444444444444444444444444449889999999999999999999999995555555999999888888888888889999999999999999999999999999444444444444444444444444444444444444444444444444
    4444444444444444444444444444444989999999999999999999999989999999888888888888888899999999999999999999999999999944444444444444444444444444444444444444444444444444
    4444444444444444444444444444444489999999999999999999999998888888888888888888889999989999999999999999999999994444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444449999999999999999999999988888888888888888889999999999999999999999999999999944444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444999999999999999999999988888888888888888998999999999999999999999999999994444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444999999999999999999999888888888888888999999999999999999999999999999999944444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444499999999999999999999888888888888899999999999999999999999999999999994444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444499999999999999999999888888888899999999999999999999999999999999999444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444499999999999999999998888888889999999999999999999999999999999999994444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444449999999999999999998888888999999999999999999999999999999999999444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444999999999999999998888999999999999999999999999999999999999944444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444499999999999999998999999999999999999999999999999999999994444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444449999999999999999999999999999999999999999999999999999944444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444999999999999999999999999999999999999999999999999994444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444499999999999999999999999999999999999999999999999444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444449999999999999999999999999999999999999999999994444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444999999999999999999999999999999999999999999444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444999999999999999999999999999999999999999944444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444499999999999999999999999999999999999994444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444449999999999999999999999999999999999944444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444449999999999999999999999999999999994444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444499999999999999999999999999999999994444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444499999999999999999999999999999999999999944444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444499999999999999999999999999999999999999999994444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444499994499999999999999999999999999999999999999999944444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444499944444999999999999999999999999999999999999999999999444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444499444444444999999999999999999999999999999999999999999999994444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444494444444444449999999999999999999999999999999999999999999999999994444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444499999999999999999999999999999999999999999999999999999999444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444999999949999999999999999999999999999999999999999999999999999944444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444449999994444449999999999999999999999999999999999999999999999999999944444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444999999444444444449999999999999999999999999999999999999999999999999999994444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444449999944444444444444499999999999999999999999999999999999999999999999999999999444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444999994444444444444444444499999999999999999999999999999999999999999999999999999999444444444444444444444444444444
    4444444444444444444444444444444444444444444444449999444444444444444444444444499999999999999999999999999999999999999999999999999994444444444444444444444444444444
    4444444444444444444444444444444444444444444444999944444444444444444444444444444499999999999999999999999999999999999999999999999944444444444444444444444444444444
    4444444444444444444444444444444444444444444499994444444444444444444444444444444444499999999999999999999999999999999999999999994444444444444444444444444444444444
    4444444444444444444444444444444444444444444999444444444444444444444444444444444444444999999999999999999999999999999999999999444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444999999999999999999999999999999999944444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    4444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444
    `)
initializeAnimations()
createPlayer(hero)
let levelCount = 8
let currentLevel = 0
setLevelTileMap(currentLevel)
giveIntroduction()
// set up hero animations
game.onUpdate(function () {
    if (hero.vx < 0) {
        heroFacingLeft = true
    } else if (hero.vx > 0) {
        heroFacingLeft = false
    }
    if (hero.isHittingTile(CollisionDirection.Top)) {
        hero.vy = 0
    }
    if (controller.down.isPressed()) {
        if (heroFacingLeft) {
            animation.setAction(hero, ActionKind.CrouchLeft)
        } else {
            animation.setAction(hero, ActionKind.CrouchRight)
        }
    } else if (hero.vy < 20 && !(hero.isHittingTile(CollisionDirection.Bottom))) {
        if (heroFacingLeft) {
            animation.setAction(hero, ActionKind.JumpingLeft)
        } else {
            animation.setAction(hero, ActionKind.JumpingRight)
        }
    } else if (hero.vx < 0) {
        animation.setAction(hero, ActionKind.RunningLeft)
    } else if (hero.vx > 0) {
        animation.setAction(hero, ActionKind.RunningRight)
    } else {
        if (heroFacingLeft) {
            animation.setAction(hero, ActionKind.IdleLeft)
        } else {
            animation.setAction(hero, ActionKind.IdleRight)
        }
    }
})
// Flier movement
game.onUpdate(function () {
    for (let value8 of sprites.allOfKind(SpriteKind.Flier)) {
        if (Math.abs(value8.x - hero.x) < 60) {
            if (value8.x - hero.x < -5) {
                value8.vx = 25
            } else if (value8.x - hero.x > 5) {
                value8.vx = -25
            }
            if (value8.y - hero.y < -5) {
                value8.vy = 25
            } else if (value8.y - hero.y > 5) {
                value8.vy = -25
            }
            animation.setAction(value8, ActionKind.Flying)
        } else {
            value8.vy = -20
            value8.vx = 0
            animation.setAction(value8, ActionKind.Idle)
        }
    }
})
// Reset double jump when standing on wall
game.onUpdate(function () {
    if (hero.isHittingTile(CollisionDirection.Bottom)) {
        canDoubleJump = true
    }
})
// bumper movement
game.onUpdate(function () {
    for (let value9 of sprites.allOfKind(SpriteKind.Bumper)) {
        if (value9.isHittingTile(CollisionDirection.Left)) {
            value9.vx = Math.randomRange(30, 60)
        } else if (value9.isHittingTile(CollisionDirection.Right)) {
            value9.vx = Math.randomRange(-60, -30)
        }
    }
})
